<%
  let title_parts;
  if (forum === 'solutions') {
    title_parts = ['题解'];
  } else {
    title_parts = ['讨论'];
  }
  if (problem) title_parts.push(problem.title);
  this.title = title_parts.join(' - ');
%>
<% include discussion_util %>
<%
  const in_problems = ['problems', 'solutions'].includes(forum) && !problem;

  let url_new_article = null;
  if (!in_problems && user) {
    let params = { forum };
    if (problem) params.problem_id = problem.id;
    url_new_article = syzoj.utils.makeUrl(['article', 0, 'edit'], params);
  }
%>
<% include header %>
<div class="padding">
  <div class="ui grid">
    <div class="row" style="margin-bottom: 10px; ">
      <div class="ten wide column">
        <% include discussion_breadcrumb %>
      </div>
      <div class="six wide right aligned column">
        <% if (problem) { %>
          <a style="margin-left: 10px; " href="<%= syzoj.utils.makeUrl(['problem', problem.id]) %>" class="ui labeled icon mini blue button">
            <i class="arrow left icon"></i>
            返回题目
          </a>
        <% } %>
        <% if (articles.length && url_new_article) { %>
          <a style="margin-left: 10px; " href="<%= url_new_article %>" class="ui labeled icon mini button">
            <i class="write icon"></i>
            发帖
          </a>
        <% } %>
      </div>
    </div>
  </div>
  <% if (articles.length) { %>
  <table class="ui very basic center aligned table">
    <thead>
      <tr>
        <th class="left aligned" style="width: 45%; ">标题</th>
        <% if (in_problems) { %>
          <th style="width: 20%; ">所属题目</th>
        <% } %>
        <th style="width: 10%; ">作者</th>
        <th style="width: 10%; ">回复数</th>
        <th style="width: 15%; ">最新回复</th>
      </tr>
    </thead>
    <tbody>
    <% for (let article of articles) { %>
        <tr>
            <td class="left aligned"><a href="<%= syzoj.utils.makeUrl(['article', article.id]) %>"><%= article.title %></a></td>
            <% if (in_problems) { %>
              <td><a href="<%= get_list_url(article.forum, article.problem.id) %>"><%= article.problem.title %></a></td>
            <% } %>
            <td><a href="<%= syzoj.utils.makeUrl(['user', article.user_id]) %>"><%= article.user.username %></a><% if (article.user.nameplate) { %><%- article.user.nameplate %><% } %></td>
            <td><%= article.comments_num %></td>
            <td><%= syzoj.utils.formatDate(article.sort_time) %></td>
        </tr>
    <% } %>
    </tbody>
  </table>
  <br>
  <% include page %>
  <% } else { %>
  <div class="ui placeholder segment">
    <div class="ui icon header">
      <i class="chat icon" style="margin-bottom: 20px; "></i>
      暂无讨论
    </div>
    <% if (url_new_article) { %>
      <a href="<%= url_new_article %>" class="ui primary labeled icon button">
        <i class="write icon"></i>
        发帖
      </a>
    <% } %>
  </div>
  <% } %>
</div>
<% include footer %>
